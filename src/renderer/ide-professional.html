<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArmEditor - Professional ARM IDE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #cccccc;
            overflow: hidden;
            height: 100vh;
        }

        /* TOP MENU BAR */
        .top-menu {
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            height: 40px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 5px;
        }

        .menu-item {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 13px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .menu-item:hover {
            background: #3e3e42;
        }

        .menu-item.active {
            background: #094771;
        }

        /* MAIN CONTAINER */
        .main-container {
            display: flex;
            height: calc(100vh - 40px);
        }

        /* LEFT SIDEBAR */
        .sidebar {
            width: 60px;
            background: #252526;
            border-right: 1px solid #3e3e42;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
            gap: 5px;
        }

        .sidebar-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            position: relative;
        }

        .sidebar-icon:hover {
            background: #2a2d2e;
        }

        .sidebar-icon.active {
            background: #094771;
        }

        .sidebar-icon::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 60px;
            background: #2d2d30;
            color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
        }

        .sidebar-icon:hover::after {
            opacity: 1;
        }

        /* CONTENT AREA */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .view {
            display: none;
            flex: 1;
            overflow: auto;
        }

        .view.active {
            display: flex;
            flex-direction: column;
        }

        /* ST-LINK VIEW */
        .stlink-view {
            padding: 20px;
            gap: 20px;
            overflow-y: auto;
        }

        .card {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title-icon {
            font-size: 20px;
        }

        /* CONNECTION PANEL */
        .connection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            color: #cccccc;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            color: #cccccc;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-control:focus {
            border-color: #007acc;
        }

        select.form-control {
            cursor: pointer;
        }

        /* DEVICE LIST */
        .device-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .device-card {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: border-color 0.2s, background 0.2s;
        }

        .device-card:hover {
            border-color: #007acc;
            background: #2a2d2e;
        }

        .device-card.connected {
            border-color: #4ec9b0;
            background: #1a3329;
        }

        .device-info {
            flex: 1;
        }

        .device-name {
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .device-details {
            font-size: 12px;
            color: #858585;
        }

        .device-status {
            font-size: 12px;
            color: #4ec9b0;
            margin-top: 5px;
        }

        .device-card.connected .device-status {
            color: #4ec9b0;
        }

        /* BUTTONS */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            font-weight: 500;
            outline: none;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: #0e639c;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #1177bb;
        }

        .btn-success {
            background: #16825d;
            color: #ffffff;
        }

        .btn-success:hover {
            background: #1a9870;
        }

        .btn-danger {
            background: #a1260d;
            color: #ffffff;
        }

        .btn-danger:hover {
            background: #c72e0d;
        }

        .btn-secondary {
            background: #3e3e42;
            color: #cccccc;
        }

        .btn-secondary:hover {
            background: #4e4e52;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* MEMORY VIEW */
        .memory-view {
            padding: 20px;
        }

        .memory-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: flex-end;
        }

        .memory-table {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            overflow: hidden;
        }

        .memory-table table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 12px;
        }

        .memory-table th {
            background: #2d2d30;
            color: #ffffff;
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #3e3e42;
        }

        .memory-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #2d2d30;
        }

        .memory-table tr:hover {
            background: #2a2d2e;
        }

        .memory-address {
            color: #4ec9b0;
        }

        .memory-hex {
            color: #ce9178;
            font-family: monospace;
        }

        .memory-ascii {
            color: #858585;
        }

        /* FLASH DOWNLOAD VIEW */
        .flash-view {
            padding: 20px;
        }

        .file-drop-zone {
            background: #1e1e1e;
            border: 2px dashed #3e3e42;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s, background 0.2s;
            margin-bottom: 20px;
        }

        .file-drop-zone:hover {
            border-color: #007acc;
            background: #252526;
        }

        .file-drop-zone.drag-over {
            border-color: #4ec9b0;
            background: #1a3329;
        }

        .drop-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .drop-text {
            font-size: 14px;
            color: #cccccc;
            margin-bottom: 5px;
        }

        .drop-hint {
            font-size: 12px;
            color: #858585;
        }

        .file-info {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .file-info.active {
            display: block;
        }

        .file-info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 13px;
        }

        .file-info-label {
            color: #858585;
        }

        .file-info-value {
            color: #ffffff;
            font-family: monospace;
        }

        .flash-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            font-size: 13px;
            cursor: pointer;
            user-select: none;
        }

        .flash-actions {
            display: flex;
            gap: 10px;
        }

        /* OUTPUT CONSOLE */
        .output-console {
            background: #1e1e1e;
            border-top: 1px solid #3e3e42;
            height: 200px;
            display: flex;
            flex-direction: column;
        }

        .console-header {
            background: #2d2d30;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #3e3e42;
        }

        .console-title {
            font-size: 13px;
            font-weight: 500;
        }

        .console-actions {
            display: flex;
            gap: 10px;
        }

        .console-btn {
            background: none;
            border: none;
            color: #cccccc;
            cursor: pointer;
            font-size: 16px;
            padding: 4px 8px;
            border-radius: 3px;
            transition: background 0.2s;
        }

        .console-btn:hover {
            background: #3e3e42;
        }

        .console-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px 15px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
        }

        .console-line {
            margin-bottom: 2px;
        }

        .console-line.error {
            color: #f48771;
        }

        .console-line.success {
            color: #4ec9b0;
        }

        .console-line.warning {
            color: #dcdcaa;
        }

        /* STATUS BAR */
        .status-bar {
            background: #007acc;
            height: 24px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            font-size: 12px;
            justify-content: space-between;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-icon {
            font-size: 14px;
        }

        /* EDITOR VIEW */
        .editor-view {
            display: flex;
            height: 100%;
        }

        .file-explorer {
            width: 250px;
            background: #252526;
            border-right: 1px solid #3e3e42;
            display: flex;
            flex-direction: column;
        }

        .explorer-header {
            padding: 10px 15px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            font-size: 13px;
            font-weight: 600;
        }

        .file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .file-item, .folder-item {
            padding: 6px 16px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            user-select: none;
        }

        .file-item:hover, .folder-item:hover {
            background: #2a2d2e;
        }

        .file-item.active {
            background: #094771;
            color: #ffffff;
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .editor-tabs {
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            overflow-x: auto;
        }

        .editor-tab {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 13px;
            border-right: 1px solid #3e3e42;
            display: flex;
            align-items: center;
            gap: 8px;
            background: #2d2d30;
            transition: background 0.2s;
        }

        .editor-tab:hover {
            background: #1e1e1e;
        }

        .editor-tab.active {
            background: #1e1e1e;
        }

        .tab-close {
            margin-left: 5px;
            opacity: 0.6;
        }

        .tab-close:hover {
            opacity: 1;
        }

        .code-editor {
            flex: 1;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            overflow: auto;
            resize: none;
            border: none;
            outline: none;
        }

        /* DEVICE INFO PANEL */
        .device-info-panel {
            background: #252526;
            border-left: 1px solid #3e3e42;
            width: 300px;
            padding: 20px;
            overflow-y: auto;
        }

        .info-section {
            margin-bottom: 20px;
        }

        .info-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 12px;
            border-bottom: 1px solid #2d2d30;
        }

        .info-label {
            color: #858585;
        }

        .info-value {
            color: #cccccc;
            font-family: monospace;
        }

        .connection-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .connection-indicator.connected {
            background: #4ec9b0;
            box-shadow: 0 0 6px #4ec9b0;
        }

        .connection-indicator.disconnected {
            background: #858585;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        ::-webkit-scrollbar-thumb {
            background: #424242;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4e4e4e;
        }

        /* PROGRESS BAR */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #2d2d30;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
            display: none;
        }

        .progress-bar.active {
            display: block;
        }

        .progress-fill {
            height: 100%;
            background: #007acc;
            transition: width 0.3s;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <!-- TOP MENU -->
    <div class="top-menu">
        <div class="menu-item" onclick="openProject()">üìÇ Open Project</div>
        <div class="menu-item" onclick="buildProject()">üî® Build</div>
        <div class="menu-item" onclick="flashFirmware()">‚ö° Flash</div>
        <div class="menu-item" onclick="showView('stlink')">üîå ST-Link</div>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="main-container">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-icon active" data-tooltip="Editor" onclick="showView('editor')">üìù</div>
            <div class="sidebar-icon" data-tooltip="ST-Link Manager" onclick="showView('stlink')">üîå</div>
            <div class="sidebar-icon" data-tooltip="Memory Browser" onclick="showView('memory')">üíæ</div>
            <div class="sidebar-icon" data-tooltip="Flash Download" onclick="showView('flash')">‚ö°</div>
            <div class="sidebar-icon" data-tooltip="Option Bytes" onclick="showView('options')">‚öôÔ∏è</div>
        </div>

        <!-- CONTENT AREA -->
        <div class="content-area">
            <!-- EDITOR VIEW -->
            <div class="view active" id="editor-view">
                <div class="editor-view">
                    <div class="file-explorer">
                        <div class="explorer-header">PROJECT EXPLORER</div>
                        <div class="file-tree" id="file-tree">
                            <div style="padding: 20px; text-align: center; color: #858585;">
                                Open a project to start
                            </div>
                        </div>
                    </div>
                    <div class="editor-container">
                        <div class="editor-tabs" id="editor-tabs">
                            <div class="editor-tab active">
                                <span>Welcome</span>
                            </div>
                        </div>
                        <textarea class="code-editor" id="code-editor" placeholder="Select a file to edit..."></textarea>
                    </div>
                </div>
            </div>

            <!-- ST-LINK VIEW -->
            <div class="view stlink-view" id="stlink-view">
                <!-- CONNECTION SETTINGS -->
                <div class="card">
                    <div class="card-title">
                        <span class="card-title-icon">üîå</span>
                        ST-Link Connection Settings
                    </div>
                    <div class="connection-grid">
                        <div>
                            <div class="form-group">
                                <label class="form-label">Debug Interface</label>
                                <select class="form-control" id="debug-interface">
                                    <option value="swd">SWD (Serial Wire Debug)</option>
                                    <option value="jtag">JTAG</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Frequency (kHz)</label>
                                <select class="form-control" id="debug-frequency">
                                    <option value="5">5 kHz</option>
                                    <option value="25">25 kHz</option>
                                    <option value="100">100 kHz</option>
                                    <option value="240">240 kHz</option>
                                    <option value="950">950 kHz</option>
                                    <option value="1800" selected>1800 kHz</option>
                                    <option value="4000">4000 kHz</option>
                                    <option value="8000">8000 kHz</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label class="form-label">Reset Mode</label>
                                <select class="form-control" id="reset-mode">
                                    <option value="software">Software System Reset</option>
                                    <option value="hardware">Hardware Reset (nRST)</option>
                                    <option value="core">Core Reset</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Connection Mode</label>
                                <select class="form-control" id="connection-mode">
                                    <option value="normal">Normal</option>
                                    <option value="hotplug">Hot Plug</option>
                                    <option value="under-reset">Connect Under Reset</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label class="form-label">Shared Mode</label>
                                <select class="form-control" id="shared-mode">
                                    <option value="disabled">Disabled</option>
                                    <option value="enabled">Enabled</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Target MCU</label>
                                <select class="form-control" id="target-mcu">
                                    <option value="stm32f4x">STM32F4xx</option>
                                    <option value="stm32f1x">STM32F1xx</option>
                                    <option value="stm32f0x">STM32F0xx</option>
                                    <option value="stm32l4x">STM32L4xx</option>
                                    <option value="stm32g0x">STM32G0xx</option>
                                    <option value="stm32g4x">STM32G4xx</option>
                                    <option value="stm32h7x">STM32H7xx</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="refreshDevices()">üîÑ Refresh Devices</button>
                </div>

                <!-- DEVICE LIST -->
                <div class="card">
                    <div class="card-title">
                        <span class="card-title-icon">üì±</span>
                        Connected Devices
                    </div>
                    <div class="device-list" id="device-list">
                        <div style="padding: 20px; text-align: center; color: #858585;">
                            Click "Refresh Devices" to scan for ST-Link
                        </div>
                    </div>
                </div>
            </div>

            <!-- MEMORY VIEW -->
            <div class="view memory-view" id="memory-view">
                <div class="card">
                    <div class="card-title">
                        <span class="card-title-icon">üíæ</span>
                        Memory Browser
                    </div>
                    <div class="memory-controls">
                        <div class="form-group" style="margin: 0;">
                            <label class="form-label">Start Address (Hex)</label>
                            <input type="text" class="form-control" id="memory-address" value="0x08000000" style="width: 150px;">
                        </div>
                        <div class="form-group" style="margin: 0;">
                            <label class="form-label">Size (bytes)</label>
                            <input type="number" class="form-control" id="memory-size" value="256" style="width: 120px;">
                        </div>
                        <button class="btn btn-primary" onclick="readMemory()">üìñ Read</button>
                        <button class="btn btn-secondary" onclick="saveMemory()">üíæ Save to File</button>
                    </div>
                    <div class="memory-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Address</th>
                                    <th>+0</th>
                                    <th>+1</th>
                                    <th>+2</th>
                                    <th>+3</th>
                                    <th>+4</th>
                                    <th>+5</th>
                                    <th>+6</th>
                                    <th>+7</th>
                                    <th>+8</th>
                                    <th>+9</th>
                                    <th>+A</th>
                                    <th>+B</th>
                                    <th>+C</th>
                                    <th>+D</th>
                                    <th>+E</th>
                                    <th>+F</th>
                                    <th>ASCII</th>
                                </tr>
                            </thead>
                            <tbody id="memory-table-body">
                                <tr>
                                    <td colspan="18" style="text-align: center; color: #858585; padding: 40px;">
                                        Connect to ST-Link and click "Read" to view memory
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- FLASH DOWNLOAD VIEW -->
            <div class="view flash-view" id="flash-view">
                <div class="card">
                    <div class="card-title">
                        <span class="card-title-icon">‚ö°</span>
                        Flash Download
                    </div>

                    <div class="file-drop-zone" id="drop-zone" onclick="selectFile()">
                        <div class="drop-icon">üìÅ</div>
                        <div class="drop-text">Drag and drop firmware file here</div>
                        <div class="drop-hint">Supported: .hex, .bin, .elf</div>
                    </div>
                    <input type="file" id="file-input" accept=".hex,.bin,.elf" style="display: none;">

                    <div class="file-info" id="file-info">
                        <div class="file-info-row">
                            <span class="file-info-label">File Name:</span>
                            <span class="file-info-value" id="file-name">-</span>
                        </div>
                        <div class="file-info-row">
                            <span class="file-info-label">File Size:</span>
                            <span class="file-info-value" id="file-size">-</span>
                        </div>
                        <div class="file-info-row">
                            <span class="file-info-label">File Type:</span>
                            <span class="file-info-value" id="file-type">-</span>
                        </div>
                        <div class="file-info-row">
                            <span class="file-info-label">Start Address:</span>
                            <span class="file-info-value" id="file-address">0x08000000</span>
                        </div>
                    </div>

                    <div class="card-title" style="margin-top: 20px;">Download Options</div>
                    <div class="flash-options">
                        <div class="checkbox-group">
                            <input type="checkbox" id="verify-after" checked>
                            <label for="verify-after">Verify after programming</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="run-after" checked>
                            <label for="run-after">Run after programming</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="full-chip-erase">
                            <label for="full-chip-erase">Full chip erase</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="skip-erase">
                            <label for="skip-erase">Skip flash erase</label>
                        </div>
                    </div>

                    <div class="progress-bar" id="flash-progress">
                        <div class="progress-fill" id="flash-progress-fill" style="width: 0%"></div>
                    </div>

                    <div class="flash-actions">
                        <button class="btn btn-success" onclick="startDownload()" id="download-btn" disabled>
                            ‚ö° Start Programming
                        </button>
                        <button class="btn btn-danger" onclick="eraseChip()">
                            üóëÔ∏è Erase Chip
                        </button>
                        <button class="btn btn-secondary" onclick="readDeviceMemory()">
                            üìñ Read Device Memory
                        </button>
                    </div>
                </div>
            </div>

            <!-- OPTION BYTES VIEW -->
            <div class="view" id="options-view" style="padding: 20px;">
                <div class="card">
                    <div class="card-title">
                        <span class="card-title-icon">‚öôÔ∏è</span>
                        Option Bytes Configuration
                    </div>
                    <div style="padding: 40px; text-align: center; color: #858585;">
                        <div style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è</div>
                        <div style="font-size: 14px; margin-bottom: 10px;">Option Bytes Configuration</div>
                        <div style="font-size: 12px;">
                            Connect to a device to configure option bytes<br>
                            (Read Protection, Write Protection, Boot Configuration)
                        </div>
                    </div>
                </div>
            </div>

            <!-- OUTPUT CONSOLE -->
            <div class="output-console">
                <div class="console-header">
                    <div class="console-title">OUTPUT</div>
                    <div class="console-actions">
                        <button class="console-btn" onclick="clearConsole()" title="Clear">üóëÔ∏è</button>
                        <button class="console-btn" onclick="saveConsoleLog()" title="Save Log">üíæ</button>
                    </div>
                </div>
                <div class="console-content" id="console-output">
                    <div class="console-line">ArmEditor Professional v1.0.0</div>
                    <div class="console-line">Ready.</div>
                </div>
            </div>
        </div>

        <!-- DEVICE INFO PANEL -->
        <div class="device-info-panel">
            <div class="info-section">
                <div class="info-section-title">Connection Status</div>
                <div class="info-row">
                    <span class="info-label">Status:</span>
                    <span class="info-value">
                        <span class="connection-indicator disconnected" id="connection-indicator"></span>
                        <span id="connection-status">Disconnected</span>
                    </span>
                </div>
            </div>

            <div class="info-section" id="stlink-info-section" style="display: none;">
                <div class="info-section-title">ST-Link Information</div>
                <div class="info-row">
                    <span class="info-label">Version:</span>
                    <span class="info-value" id="stlink-version">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Firmware:</span>
                    <span class="info-value" id="stlink-firmware">-</span>
                </div>
            </div>

            <div class="info-section" id="mcu-info-section" style="display: none;">
                <div class="info-section-title">MCU Information</div>
                <div class="info-row">
                    <span class="info-label">Device:</span>
                    <span class="info-value" id="mcu-device">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Device ID:</span>
                    <span class="info-value" id="mcu-id">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Flash Size:</span>
                    <span class="info-value" id="mcu-flash">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">RAM Size:</span>
                    <span class="info-value" id="mcu-ram">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Core:</span>
                    <span class="info-value" id="mcu-core">-</span>
                </div>
            </div>

            <div class="info-section">
                <div class="info-section-title">Quick Actions</div>
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="showView('stlink')">
                    üîå Connection Settings
                </button>
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="showView('flash')">
                    ‚ö° Flash Firmware
                </button>
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="showView('memory')">
                    üíæ Memory Browser
                </button>
            </div>
        </div>
    </div>

    <!-- STATUS BAR -->
    <div class="status-bar">
        <div class="status-item">
            <span class="status-icon">üìÅ</span>
            <span id="status-project">No project</span>
        </div>
        <div class="status-item">
            <span class="status-icon">üîå</span>
            <span id="status-device">No device</span>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        let currentProject = null;
        let currentDevice = null;
        let selectedFile = null;

        // View management
        function showView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));

            // Show selected view
            document.getElementById(viewName + '-view').classList.add('active');

            // Update sidebar icons
            document.querySelectorAll('.sidebar-icon').forEach(icon => {
                icon.classList.remove('active');
            });

            const views = ['editor', 'stlink', 'memory', 'flash', 'options'];
            const index = views.indexOf(viewName);
            if (index >= 0) {
                document.querySelectorAll('.sidebar-icon')[index].classList.add('active');
            }
        }

        // Console functions
        function appendConsole(message, type = 'normal') {
            const console = document.getElementById('console-output');
            const line = document.createElement('div');
            line.className = 'console-line ' + type;
            line.textContent = message;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
            appendConsole('Console cleared.', 'normal');
        }

        function saveConsoleLog() {
            const content = document.getElementById('console-output').innerText;
            ipcRenderer.send('save-console-log', content);
            appendConsole('Log saved.', 'success');
        }

        // Project functions
        function openProject() {
            ipcRenderer.send('open-project');
        }

        function buildProject() {
            if (!currentProject) {
                appendConsole('Error: No project opened', 'error');
                return;
            }
            appendConsole('Building project...', 'normal');
            ipcRenderer.send('build-project');
        }

        function flashFirmware() {
            if (!currentDevice) {
                appendConsole('Error: No device connected', 'error');
                return;
            }
            showView('flash');
        }

        // ST-Link functions
        function refreshDevices() {
            appendConsole('Scanning for ST-Link devices...', 'normal');
            ipcRenderer.send('scan-stlink');
        }

        function connectDevice(deviceId) {
            appendConsole('Connecting to device...', 'normal');
            ipcRenderer.send('connect-stlink', deviceId);
        }

        function disconnectDevice(deviceId) {
            appendConsole('Disconnecting device...', 'normal');
            ipcRenderer.send('disconnect-stlink', deviceId);
        }

        // Memory functions
        function readMemory() {
            if (!currentDevice) {
                appendConsole('Error: No device connected', 'error');
                return;
            }

            const address = document.getElementById('memory-address').value;
            const size = parseInt(document.getElementById('memory-size').value);

            appendConsole(`Reading ${size} bytes from ${address}...`, 'normal');
            ipcRenderer.send('read-memory', { address, size });
        }

        function saveMemory() {
            appendConsole('Saving memory dump...', 'normal');
            // TODO: Implement save memory
        }

        // Flash functions
        function selectFile() {
            document.getElementById('file-input').click();
        }

        document.getElementById('file-input').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                selectedFile = file;
                document.getElementById('file-info').classList.add('active');
                document.getElementById('file-name').textContent = file.name;
                document.getElementById('file-size').textContent = (file.size / 1024).toFixed(2) + ' KB';
                document.getElementById('file-type').textContent = file.name.split('.').pop().toUpperCase();
                document.getElementById('download-btn').disabled = false;
                appendConsole(`File selected: ${file.name}`, 'success');
            }
        });

        function startDownload() {
            if (!currentDevice) {
                appendConsole('Error: No device connected', 'error');
                return;
            }

            if (!selectedFile) {
                appendConsole('Error: No file selected', 'error');
                return;
            }

            const options = {
                verify: document.getElementById('verify-after').checked,
                run: document.getElementById('run-after').checked,
                fullErase: document.getElementById('full-chip-erase').checked,
                skipErase: document.getElementById('skip-erase').checked
            };

            appendConsole('Starting flash programming...', 'normal');
            document.getElementById('flash-progress').classList.add('active');

            ipcRenderer.send('flash-firmware', { file: selectedFile.path, options });
        }

        function eraseChip() {
            if (!currentDevice) {
                appendConsole('Error: No device connected', 'error');
                return;
            }

            if (confirm('Are you sure you want to erase the entire chip?')) {
                appendConsole('Erasing chip...', 'warning');
                ipcRenderer.send('erase-chip');
            }
        }

        function readDeviceMemory() {
            if (!currentDevice) {
                appendConsole('Error: No device connected', 'error');
                return;
            }

            appendConsole('Reading device memory...', 'normal');
            ipcRenderer.send('read-device-memory');
        }

        // Drag and drop
        const dropZone = document.getElementById('drop-zone');

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');

            const file = e.dataTransfer.files[0];
            if (file) {
                selectedFile = file;
                document.getElementById('file-info').classList.add('active');
                document.getElementById('file-name').textContent = file.name;
                document.getElementById('file-size').textContent = (file.size / 1024).toFixed(2) + ' KB';
                document.getElementById('file-type').textContent = file.name.split('.').pop().toUpperCase();
                document.getElementById('download-btn').disabled = false;
                appendConsole(`File selected: ${file.name}`, 'success');
            }
        });

        // IPC event listeners
        ipcRenderer.on('project-opened', (event, project) => {
            currentProject = project;
            document.getElementById('status-project').textContent = project.name;
            appendConsole(`Project opened: ${project.name}`, 'success');

            // Update file tree
            const tree = document.getElementById('file-tree');
            tree.innerHTML = '';
            if (project.folders) {
                renderFolderTree(project.folders, tree, 0);
            }
        });

        ipcRenderer.on('stlink-devices', (event, devices) => {
            const list = document.getElementById('device-list');
            list.innerHTML = '';

            if (devices.length === 0) {
                list.innerHTML = '<div style="padding: 20px; text-align: center; color: #858585;">No ST-Link devices found</div>';
                return;
            }

            devices.forEach(device => {
                const card = document.createElement('div');
                card.className = 'device-card' + (device.connected ? ' connected' : '');

                card.innerHTML = `
                    <div class="device-info">
                        <div class="device-name">${device.name}</div>
                        <div class="device-details">Serial: ${device.serial || 'Unknown'}</div>
                        ${device.mcu ? `<div class="device-details">MCU: ${device.mcu}</div>` : ''}
                        ${device.connected ? '<div class="device-status">‚úì Connected</div>' : ''}
                    </div>
                    <button class="btn ${device.connected ? 'btn-danger' : 'btn-success'}"
                            onclick="${device.connected ? 'disconnectDevice' : 'connectDevice'}('${device.id}')">
                        ${device.connected ? 'üîå Disconnect' : 'üîå Connect'}
                    </button>
                `;

                list.appendChild(card);
            });

            appendConsole(`Found ${devices.length} ST-Link device(s)`, 'success');
        });

        ipcRenderer.on('device-connected', (event, deviceInfo) => {
            currentDevice = deviceInfo;
            document.getElementById('status-device').textContent = deviceInfo.name;
            document.getElementById('connection-status').textContent = 'Connected';
            document.getElementById('connection-indicator').classList.remove('disconnected');
            document.getElementById('connection-indicator').classList.add('connected');

            // Show info panels
            document.getElementById('stlink-info-section').style.display = 'block';
            document.getElementById('mcu-info-section').style.display = 'block';

            // Update info
            if (deviceInfo.stlink) {
                document.getElementById('stlink-version').textContent = deviceInfo.stlink.version;
                document.getElementById('stlink-firmware').textContent = deviceInfo.stlink.firmware;
            }

            if (deviceInfo.mcu) {
                document.getElementById('mcu-device').textContent = deviceInfo.mcu.device;
                document.getElementById('mcu-id').textContent = deviceInfo.mcu.id;
                document.getElementById('mcu-flash').textContent = deviceInfo.mcu.flash;
                document.getElementById('mcu-ram').textContent = deviceInfo.mcu.ram;
                document.getElementById('mcu-core').textContent = deviceInfo.mcu.core;
            }

            appendConsole('Device connected successfully', 'success');
        });

        ipcRenderer.on('device-disconnected', () => {
            currentDevice = null;
            document.getElementById('status-device').textContent = 'No device';
            document.getElementById('connection-status').textContent = 'Disconnected';
            document.getElementById('connection-indicator').classList.remove('connected');
            document.getElementById('connection-indicator').classList.add('disconnected');

            document.getElementById('stlink-info-section').style.display = 'none';
            document.getElementById('mcu-info-section').style.display = 'none';

            appendConsole('Device disconnected', 'warning');
        });

        ipcRenderer.on('output-append', (event, text) => {
            const lines = text.split('\n');
            lines.forEach(line => {
                if (line.trim()) {
                    let type = 'normal';
                    if (line.includes('‚ùå') || line.includes('Error')) type = 'error';
                    else if (line.includes('‚úÖ') || line.includes('Success')) type = 'success';
                    else if (line.includes('‚ö†Ô∏è') || line.includes('Warning')) type = 'warning';
                    appendConsole(line, type);
                }
            });
        });

        ipcRenderer.on('flash-progress', (event, percent) => {
            document.getElementById('flash-progress-fill').style.width = percent + '%';
        });

        ipcRenderer.on('build-complete', (event, result) => {
            if (result.success) {
                appendConsole('Build successful!', 'success');
            } else {
                appendConsole('Build failed: ' + result.error, 'error');
            }
        });

        function renderFolderTree(node, container, level) {
            if (node.type === 'folder') {
                const folderDiv = document.createElement('div');
                const folderItem = document.createElement('div');
                folderItem.className = 'folder-item';
                folderItem.style.paddingLeft = (8 + level * 16) + 'px';
                folderItem.innerHTML = `<span>üìÇ</span><span>${node.name}</span>`;

                const childrenDiv = document.createElement('div');
                childrenDiv.style.display = 'block';

                folderItem.onclick = () => {
                    childrenDiv.style.display = childrenDiv.style.display === 'none' ? 'block' : 'none';
                };

                folderDiv.appendChild(folderItem);
                folderDiv.appendChild(childrenDiv);
                container.appendChild(folderDiv);

                if (node.children) {
                    node.children.forEach(child => renderFolderTree(child, childrenDiv, level + 1));
                }
            } else if (node.type === 'file') {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.style.paddingLeft = (8 + level * 16) + 'px';
                fileItem.innerHTML = `<span>üìÑ</span><span>${node.name}</span>`;
                fileItem.onclick = () => {
                    ipcRenderer.send('read-file', node.path);
                };
                container.appendChild(fileItem);
            }
        }

        ipcRenderer.on('file-content', (event, data) => {
            document.getElementById('code-editor').value = data.content;
            appendConsole(`Opened: ${data.path}`, 'normal');
        });

        // Initialize
        appendConsole('ArmEditor Professional initialized', 'success');
        appendConsole('Click "Open Project" to start or "ST-Link Manager" to connect devices', 'normal');
    </script>
</body>
</html>
